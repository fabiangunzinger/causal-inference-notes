<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal inference notes - 3&nbsp; Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/neyman_rubin_causal_model.html" rel="next">
<link href="../chapters/projection.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Causal inference notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/projection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Projection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/neyman_rubin_causal_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neyman-Rubin causal model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/fisher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fisher’s exact P-value approach</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/neyman.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Neyman’s repeated sampling approach</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/threats_to_validity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Threats to validity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/practical_issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Practical issues</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/network_experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Network experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ethics</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#glossary" id="toc-glossary" class="nav-link active" data-scroll-target="#glossary"><span class="header-section-number">3.1</span> Glossary</a></li>
  <li><a href="#the-setup" id="toc-the-setup" class="nav-link" data-scroll-target="#the-setup"><span class="header-section-number">3.2</span> The setup</a></li>
  <li><a href="#classic-motivation-of-the-solution" id="toc-classic-motivation-of-the-solution" class="nav-link" data-scroll-target="#classic-motivation-of-the-solution"><span class="header-section-number">3.3</span> Classic motivation of the solution</a></li>
  <li><a href="#linear-algebra-motivation-of-the-solution" id="toc-linear-algebra-motivation-of-the-solution" class="nav-link" data-scroll-target="#linear-algebra-motivation-of-the-solution"><span class="header-section-number">3.4</span> Linear algebra motivation of the solution</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">3.5</span> Resources</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions"><span class="header-section-number">3.6</span> Assumptions</a>
  <ul class="collapse">
  <li><a href="#linearity-and-additivity" id="toc-linearity-and-additivity" class="nav-link" data-scroll-target="#linearity-and-additivity"><span class="header-section-number">3.6.1</span> Linearity and additivity</a></li>
  <li><a href="#iid-errors" id="toc-iid-errors" class="nav-link" data-scroll-target="#iid-errors"><span class="header-section-number">3.6.2</span> iid errors</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>todo: - Use DAaidson and MacKinnon metrics book: nicely separates mechanics of ols with statistical interpretation. Do the same. - Include intro on regression from <a href="https://people.duke.edu/~rnau/regintro.htm">here</a></p>
<p>Linear regression is by far the most often used method to estimate relationships between outcomes and explanatory variables in applied econometrics and – probably – all of applied social science. In this article I want to to two things: define the related terminology that is often used but not defined (OLS, linear equation, etc.) and – mainly – explain a less frequently taught and understand way to think about linear regression, that in terms of its linear algebra.</p>
<p>There are, of course, a lot of very good resources on linear regression and OLS, and I list my favourite ones at the bottom. But none of them quite tie everything together in the way I was looking for.</p>
<p>There are two ways to understand linear regression: one is to think of the variables involved as dimensions and of each row as a data point – this is the way the problem is usually motivated in introductory econometrics classes. The other is the linear algebra approach – to think of each row of data as a dimension, and to think of the variable as vectors in the space formed by those dimensions.</p>
<p>The first approach straightforwardly links to the intuition of minimising squares, which is useful. It’s the one I have learned and relied on most of my life. The second one, though, provides an alternative and very powerful way to understand what linear regression does. And, importantly, understanding the linear algebra notation simplifies much of the notation and manipulations, and opens the way to much of the literature of econometric theory, such as an understanding of the Frisch-Waugh-Lowell theorem, which was the impetus for me to dig into the linear algebra of OLS.</p>
<p>In this post I want to cover the following:</p>
<ul>
<li><p>Understand all the terminology related to linear regression so we fully know what we’re talking about</p></li>
<li><p>Understand the matrix representation of linear regression</p></li>
<li><p>Understand how we can think of the least squares solution as a projection</p></li>
<li><p>Understand why this is a very useful way of seeing things</p></li>
</ul>
<section id="glossary" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="glossary"><span class="header-section-number">3.1</span> Glossary</h2>
<p>TODO: - Linear regression vs OLS</p>
</section>
<section id="the-setup" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-setup"><span class="header-section-number">3.2</span> The setup</h2>
<p>We usually start with data of the form <span class="math inline">\(\{y_i, x_{i1}, \cdots, x_{ik}\}_{i=1}^N\)</span>, where we observe an outcome variable <span class="math inline">\(y_i\)</span> and a set of <span class="math inline">\(k\)</span> explanatory variables <span class="math inline">\(x_i = (x_{i1}, \cdots, x_{ik})\)</span> for each unit <span class="math inline">\(i\)</span> in the dataset. We think that it might be reasonable to think of the outcome being linearly related to the regressors, so that, for each unit in our dataset, we can write the following linear equation:</p>
<p><span class="math display">\[
y_{i} = \beta_{1}x_{i1} + \beta_{2}x_{i2} + ... + \beta_{k}x_{ik} + \epsilon_{i}
\]</span></p>
<p>This says that the outcome <span class="math inline">\(y\)</span> can be thought of as a linear combination of all explanatory variables plus some error term.</p>
<p>TODO: What makes this a “linear” equation: - The highest power to which any regressor is raised is 1 - The coefficients are constants, not variables - Regressors are related to one another using addition and subtraction only - The resulting line (in 2-D space), plane (in 3-D space) and hyperplane (in N-D space) are linear (the term linear equation originates from the simple case where there are two regressors, one of which is a constant, in which case we get a straight line in a Cartesian plane.)</p>
<p>TODO: discuss all the assumptions we’re making here.</p>
<p>TODO: Discuss the Angist &amp; Pischke view of linear regression being good approximation even if relationship is not linear.</p>
<p>We thus have a system of linear equations of the form</p>
<p><span class="math display">\[
\begin{aligned}
y_1 = \beta_0 + \beta_1 x_{1_1} + \beta_2 x_{2_1} + \ldots + \beta_k x_{k_1} + \epsilon_1 \\
y_2 = \beta_0 + \beta_1 x_{1_2} + \beta_2 x_{2_2} + \ldots + \beta_k x_{k_2} + \epsilon_2 \\
\vdots\\
y_n = \beta_0 + \beta_1 x_{1_n} + \beta_2 x_{2_n} + \ldots + \beta_k x_{k_n} + \epsilon_n \\
\end{aligned}
\]</span></p>
<p>which we can rewrite in vector notation as</p>
<p><span class="math display">\[
\begin{aligned}
y_1 = x_1'\beta + \epsilon_1 \\
y_2 = x_2'\beta + \epsilon_2 \\
\vdots\\
y_n = x_n'\beta + \epsilon_n,
\end{aligned}
\]</span></p>
<p>where <span class="math display">\[
x_i' = (x_{i1}, x_{i2}, \ldots, x_{ik})
\]</span></p>
<p>is a <span class="math inline">\(1 \times k\)</span> row vector that contains all <span class="math inline">\(k\)</span> explanatory variables for each unit <span class="math inline">\(i\)</span> and <span class="math display">\[ \beta =
\begin{pmatrix}
  \beta_{1}\\
  \beta_{2}\\
  \vdots \\
  \beta_{k}
\end{pmatrix}
\]</span></p>
<p>is a <span class="math inline">\(k \times 1\)</span> column vector that contains all <span class="math inline">\(k\)</span> regression coefficients.</p>
<p>To be even more succinct, we can stack all n equations to get the matrix notation: <span class="math display">\[
y = X\beta + \epsilon,
\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is defined as above,</p>
<p><span class="math display">\[ y =
\begin{pmatrix}
  y_{1}\\
  y_{2}\\
  \vdots \\
  y_{k}
\end{pmatrix}
\]</span></p>
<p>is a <span class="math inline">\(n \times 1\)</span> vector containing the <span class="math inline">\(n\)</span> outcome variables, one for each unit in the data,</p>
<p><span class="math display">\[ X =
\begin{pmatrix}
  x_{1}' \\
  x_{2}' \\
  \vdots \\
  x_{n}''
\end{pmatrix}
=
\begin{pmatrix}
  x_{1,1} &amp; x_{1,2} &amp; \cdots &amp; x_{1,k} \\
  x_{2,1} &amp; x_{2,2} &amp; \cdots &amp; x_{2,k} \\
  \vdots  &amp; \vdots  &amp; \ddots &amp; \vdots  \\
  x_{n,1} &amp; x_{n,2} &amp; \cdots &amp; x_{n,k}
\end{pmatrix}
\]</span></p>
<p>is an <span class="math inline">\(n \times k\)</span> matrix that contains all <span class="math inline">\(n\)</span> row vectors <span class="math inline">\(x_i'\)</span> stacked on top of each other, and</p>
<p><span class="math display">\[ \epsilon =
\begin{pmatrix}
  \epsilon_{1}\\
  \epsilon_{2}\\
  \vdots \\
  \epsilon_{k}
\end{pmatrix}
\]</span></p>
<p>a column vector containing the <span class="math inline">\(n\)</span> error terms.</p>
<p>##&nbsp;The problem</p>
<p>So, what do we want to do here? We have data on an outcome variable <span class="math inline">\(y\)</span> and explanatory variables <span class="math inline">\(x\)</span> for each unit <span class="math inline">\(i\)</span>, and we think that it is reasonable to think that this data is generated by a process whereby <span class="math inline">\(y\)</span> is the result of a linear combination of the <span class="math inline">\(x\)</span>s plus some noise, which we capture in the error term. The challenge is to find the right linear combination.</p>
</section>
<section id="classic-motivation-of-the-solution" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="classic-motivation-of-the-solution"><span class="header-section-number">3.3</span> Classic motivation of the solution</h2>
<p>TODO</p>
</section>
<section id="linear-algebra-motivation-of-the-solution" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="linear-algebra-motivation-of-the-solution"><span class="header-section-number">3.4</span> Linear algebra motivation of the solution</h2>
<p>Notice how our problem here is exactly akin to the motivation for orthogonal projection discussed in <a href="projection.html" class="quarto-xref"><span>Chapter 2</span></a>. There we had a system of linear equations of the form</p>
<p><span class="math display">\[
Ax = b
\]</span></p>
<p>which was overdetermined because the number of equations exceeded the number of unknowns. Our setup is equivalent. We have <span class="math inline">\(n\)</span> equations and <span class="math inline">\(k\)</span> unknowns (the <span class="math inline">\(\beta\)</span>s), so that – in practice – there will be no solution to the system:</p>
<p><span class="math display">\[
X\beta = y.
\]</span></p>
<p>In other words, there is no choice of <span class="math inline">\(\beta\)</span> that would linearly combine all the explanatory variables in each equation such that the result would be exactly <span class="math inline">\(y\)</span>. We account for this by adding the error term <span class="math inline">\(\epsilon\)</span>, so that we have</p>
<p><span class="math display">\[
X\beta + \epsilon = y.
\]</span></p>
<p>What we do, now, is to say that we want to find that linear combination of the explanatory variables that is closest to <span class="math inline">\(y\)</span>, so that <span class="math inline">\(\epsilon\)</span> is as small as possible, which is the same as finding the orthogonal projection of <span class="math inline">\(y\)</span> onto <span class="math inline">\(X\)</span>, which, traditionally, we call <span class="math inline">\(\hat{y}\)</span>.</p>
<p>The solution is then the same as in <a href="projection.html" class="quarto-xref"><span>Chapter 2</span></a>:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><span class="math display">\[
\begin{aligned}
X'\epsilon &amp;= 0 \\
X'(y - \hat{y}) &amp;= 0 \\
X'(y - X\beta) &amp;= 0 \\
X'y - X'X\beta &amp;= 0 \\
X'X\beta &amp;= X'y \\
\beta &amp;= (X'X)^{-1}X'y
\end{aligned}
\]</span></p>
</section>
<section id="resources" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="resources"><span class="header-section-number">3.5</span> Resources</h2>
<ul>
<li>Hayashi, Wooldridge, Verbeek, online resources</li>
</ul>
</section>
<section id="assumptions" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="assumptions"><span class="header-section-number">3.6</span> Assumptions</h2>
<ul>
<li><p>Directly copied from or heavily based on https://people.duke.edu/~rnau/testing.htm. Edit and expand over time.</p></li>
<li><p>In short, the assumptions are that the model is linear and additive, and that errors are iid. The latter assumption is often stated as three separate assumptions, as shown below.</p></li>
<li><p>Note: The dependent and independent variables in a regression model do not need to be normally distributed by themselves–only the prediction errors need to be normally distributed. (In fact, independent variables do not even need to be random, as in the case of trend or dummy or treatment or pricing variables.) But if the distributions of some of the variables that are random are extremely asymmetric or long-tailed, it may be hard to fit them into a linear model whose errors will be normally distributed, and explaining the shape of their distributions may be an interesting topic all by itself. Keep in mind that the normal error assumption is usually justified by appeal to the central limit theorem, which holds in the case where many random variations are added together. If the underlying sources of randomness are not interacting additively, this argument fails to hold.</p></li>
</ul>
<p>There are four principal assumptions which justify the use of linear regression models for purposes of inference or prediction:</p>
<ol type="i">
<li><p>linearity and additivity of the relationship between dependent and independent variables:</p>
<ol type="a">
<li><p>The expected value of dependent variable is a straight-line function of each independent variable, holding the others fixed.</p></li>
<li><p>The slope of that line does not depend on the values of the other variables.</p></li>
<li><p>The effects of different independent variables on the expected value of the dependent variable are additive.</p></li>
</ol></li>
<li><p>statistical independence of the errors (in particular, no correlation between consecutive errors in the case of time series data)</p></li>
<li><p>homoscedasticity (constant variance) of the errors</p></li>
</ol>
<ol type="a">
<li><p>versus time (in the case of time series data)</p></li>
<li><p>versus the predictions</p></li>
<li><p>versus any independent variable</p></li>
</ol>
<ol start="4" type="i">
<li>normality of the error distribution.</li>
</ol>
<p>If any of these assumptions is violated, then the forecasts, confidence intervals, and scientific insights yielded by a regression model may be (at best) inefficient or (at worst) seriously biased or misleading.</p>
<section id="linearity-and-additivity" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="linearity-and-additivity"><span class="header-section-number">3.6.1</span> Linearity and additivity</h3>
<p>Why assume linearity?</p>
<ul>
<li><p>It’s the simplest non-trivial relationship and the easiest to work with</p></li>
<li><p>True relationships are often at least approximately linear for ranges we care about</p></li>
<li><p>Even if above not true, we can often transform variables so that relationshiop is linear</p></li>
</ul>
<p>How to test linearity</p>
<ul>
<li><p>Look at scatterplot before running regression</p></li>
<li><p>Look at predicted values vs residual plot after running regression (linear model leads to evenly distributed dots across a horizontal line) – can look at predicted vs observed value plot, too, in which case you expect points to fall on the 45 degree line, but this diagonal introduces additional visual noise.</p></li>
</ul>
<p>What if linearity is violated?</p>
<ul>
<li><p>Add non-linear transformation like log (if data is strictly positive)</p></li>
<li><p>Add regressor that is a non-liner function of a current regressor (e.g.&nbsp;x^2)</p></li>
<li><p>Add new regressor that explains non-linear nature of current relationshiop</p></li>
</ul>
</section>
<section id="iid-errors" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="iid-errors"><span class="header-section-number">3.6.2</span> iid errors</h3>
<p>Why assume iid errors?</p>
<ul>
<li><p>In many cases, it’s justified by the CLT. As long as we calculate averages (sums or random variables, really), which are independent and identically distributed, the distribution will be approximately normal.</p></li>
<li><p>It’s convenient because it implies that the optimal coefficient estimates for linear models minimise the MSE, and because it justified using tests based on the normal family (t, F, Chi-square distribution).</p></li>
<li><p>Even if the “true” error process is not normal in terms of the original units of the data, it may be possible to transform the data so that your model’s prediction errors are approximately normal.</p></li>
<li><p>Note that normality is required for inferenence, not for parameter estimation or prediction.</p></li>
</ul>
<p>Potential issues</p>
<ul>
<li><p>Heteroskedasticity (variance larger depending on come conditions – certain covariate values)</p></li>
<li><p>Interdependence (e.g.&nbsp;in time-series models, in the context of network effects)</p></li>
</ul>
<p>How to check assumption</p>
<ul>
<li><p>Independence</p>
<ul>
<li>In time-series: look at residual autocorrelation</li>
<li>In non-time series: plot independent variables vs residuals – independence suggests symmetric distribution around zero and no dependence in subsequent residuals under any ordering that is not based on the independent variables (i.e.&nbsp;no correlation given covariates)</li>
</ul></li>
<li><p>Homoskedasticity</p>
<ul>
<li>Time series: plot time vs residuals</li>
<li>Non-time series: plot predicted values vs residuals and independent variables vs residuals</li>
</ul></li>
<li><p>Normality</p>
<ul>
<li><p>Normal probability plot and normal quantile plot</p></li>
<li><p>Could also use formal tests (Kolmogorov-Smirnov test, Shapiro-Wilk test, Jarque-Bera test, and the Anderson-Darling test), but they are often too restrictive in practice.</p></li>
</ul></li>
</ul>
<p>How to fix violations</p>
<ul>
<li><p>Independence</p>
<ul>
<li><p>Time-series: for mild violations (Durbin-Watson between 1.2 and 1) adding lags, for serious violations (DW &gt; 2.6) use difference model</p></li>
<li><p>Non-time series: either due to non-linearity of model or due to omitted variable.</p></li>
</ul></li>
<li><p>Homoskedasticity</p>
<ul>
<li>Log transformation</li>
<li>Model seasonality with dummies (do linearly or multiplicatively (take log of dependent variable))</li>
<li>Seasonally adjust data before fitting model</li>
</ul></li>
<li><p>Normality</p>
<ul>
<li><p>Violations of normality often arise either because (a) the distributions of the dependent and/or independent variables are themselves significantly non-normal, and/or (b) the linearity assumption is violated. In such cases, a nonlinear transformation of variables might cure both problems.</p></li>
<li><p>Another possibility is that there are two or more subsets of the data having different statistical properties, in which case separate models should be built, or else some data should merely be excluded, provided that there is some a priori criterion that can be applied to make this determination.</p></li>
<li><p>In some cases, the problem with the error distribution is mainly due to one or two very large errors. Such values should be scrutinized closely: are they genuine (i.e., not the result of data entry errors), are they explainable, are similar events likely to occur again in the future, and how influential are they in your model-fitting results? If they are merely errors or if they can be explained as unique events not likely to be repeated, then you may have cause to remove them. In some cases, however, it may be that the extreme values in the data provide the most useful information about values of some of the coefficients and/or provide the most realistic guide to the magnitudes of forecast errors.</p></li>
</ul></li>
</ul>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>One thing I would always wonder about in textbook is how I knew that the condition was <span class="math inline">\(X'\epsilon\)</span> instead of <span class="math inline">\(\epsilon'X\)</span>. The answer is that in cases where order doesn’t matter, texts tend to choose what is more convenient for the math. We could solve <span class="math inline">\(\epsilon'X\)</span>: <span class="math display">\[
\begin{aligned}
\epsilon'X &amp;= 0 \\
(y - \hat{y})'X &amp;= 0 \\
(y - X\beta)'X &amp;= 0 \\
(y' - \beta'X')X &amp;= 0 \\
y'X - \beta'X'X &amp;= 0 \\
\beta'X'X &amp;= y'X \\
(\beta'X'X)' &amp;= (y'X)' \\
X'X\beta &amp;= X'y \\
\beta &amp;= (X'X)^{-1}X'y
\end{aligned}
\]</span> which gets us to the same result but in more steps.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/projection.html" class="pagination-link  aria-label=" &lt;span="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Projection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/neyman_rubin_causal_model.html" class="pagination-link" aria-label="<span class='chapter-number'>4</span>&nbsp; <span class='chapter-title'>Neyman-Rubin causal model</span>">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Neyman-Rubin causal model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>