<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal inference notes - 2&nbsp; Projection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/regression.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/projection.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Projection</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Causal inference notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/projection.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Projection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/cuped.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">CUPED</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/useful_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Useful resources</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#projecting-from-2-d-onto-1-d" id="toc-projecting-from-2-d-onto-1-d" class="nav-link active" data-scroll-target="#projecting-from-2-d-onto-1-d"><span class="header-section-number">2.1</span> Projecting from 2-D onto 1-D</a></li>
  <li><a href="#why-project" id="toc-why-project" class="nav-link" data-scroll-target="#why-project"><span class="header-section-number">2.2</span> Why project?</a></li>
  <li><a href="#projection-from-3-d-onto-2-d-and-projecting-onto-n-d" id="toc-projection-from-3-d-onto-2-d-and-projecting-onto-n-d" class="nav-link" data-scroll-target="#projection-from-3-d-onto-2-d-and-projecting-onto-n-d"><span class="header-section-number">2.3</span> Projection from 3-D onto 2-D and projecting onto N-D</a></li>
  <li><a href="#useful-references" id="toc-useful-references" class="nav-link" data-scroll-target="#useful-references"><span class="header-section-number">2.4</span> Useful references</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-projection" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Projection</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>A projection is a transformation of a vector onto a subspace.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>There are different types of projections, but the one that’s relevant for us here is <em>orthogonal projection</em>, which projects a vector onto the nearest point on a subspace, where “nearest” usually refers to the Euclidean distance.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Why this type of projection is called “orthogonal projection” will be come clear below.</p>
<section id="projecting-from-2-d-onto-1-d" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="projecting-from-2-d-onto-1-d"><span class="header-section-number">2.1</span> Projecting from 2-D onto 1-D</h2>
<p>Projecting a vector in two-dimensional space onto a line that goes through the origin is a nice way to build an understanding for what a projection does.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Say we want to orthogonally project the vector <span class="math inline">\(b\)</span> onto a line defined by another vector, <span class="math inline">\(a\)</span>, and we will call the resulting projection <span class="math inline">\(p\)</span>. Hence, <span class="math inline">\(p\)</span> is the point on the line defined by <span class="math inline">\(a\)</span> that is nearest to the (tip of) the vector <span class="math inline">\(b\)</span>.</p>
<p>We can think of the line as being generated by scaling vector <span class="math inline">\(a\)</span> with a scalar <span class="math inline">\(x\)</span>, so that choosing a suitable <span class="math inline">\(x\)</span> allows us to reach any point on the line. Finding <span class="math inline">\(p\)</span> then boils down to finding the value of <span class="math inline">\(x\)</span> that gets us to that point of the line that is closest to <span class="math inline">\(b\)</span>. We can thus write <span class="math inline">\(p = ax\)</span>.</p>
<p>[todo: insert figure here]</p>
<p>Let’s start by finding <span class="math inline">\(p\)</span>. We can find it in different ways.</p>
<p><strong>Using calculus</strong>:</p>
<p>Minimising the distance between the (tip of) the vector, <span class="math inline">\(b\)</span>, and the projection, <span class="math inline">\(p\)</span>, is akin to solving the following problem:</p>
<p><span class="math display">\[
\begin{aligned}
argmin_{x} \sqrt{\sum_{i=1}^2{(b_i - p_i)^2}} &amp;= argmin_{x} \sum_{i=1}^2{(b_i - p_i)^2} \\
&amp;= argmin_{x} \sum_{i=1}^2{(b_i - xa_i)^2} \\
&amp;= argmin_{x} (b - xa)'(b - xa),
\end{aligned}
\]</span></p>
<p>Calculating the derivative with respect to <span class="math inline">\(x\)</span> to zero we get:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d}{dx} (b - xa)'(b - xa) &amp;= (-a)'(b - xa) + (b - xa)'(-a) &amp; \\
&amp;= -a'b + xa'a - a'b + xa'a \\
&amp;= -2a'b + 2xa'a = 0
\end{aligned}
\]</span></p>
<p>Solving for <span class="math inline">\(x\)</span> we get:</p>
<p><span class="math display">\[
\begin{aligned}
-2a'b + 2xa'a &amp;= 0 \\
xa'a &amp;= a'b \\
x &amp;= (a'a)^{-1}a'b
\end{aligned}
\]</span></p>
<p>Hence, given that <span class="math inline">\(p = ax\)</span>, we have:</p>
<p><span class="math display">\[
\begin{aligned}
p = ax = \underbrace{a(a'a)^{-1}a'}_\text{$P_a$}b,
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(P_a\)</span> is the projection matrix.</p>
<p>Let’s reflect for a moment what this all means. In general, pre-multiplying a vector by a matrix transforms the vector in a particular way. When we perform orthogonal projection, we pre-multiply a vector by a matrix that transforms the vector into that point on a subspace that it closest to the original vector. In our case here, pre-multiplying our initial vector <span class="math inline">\(b\)</span> by the projection matrix <span class="math inline">\(P_a\)</span> transforms <span class="math inline">\(b\)</span> into that point on <span class="math inline">\(a\)</span> that is closest to <span class="math inline">\(b\)</span>, which we call <span class="math inline">\(p\)</span>. Given that we define “nearest” using the Euclidean distance, it makes sense that the projection matrix would emerge out of the solution to the minimisation problem of finding the point on the subspace that minimises the Euclidean distance to the original vector.</p>
<p><strong>Using basic geometry:</strong></p>
<p>We could also find <span class="math inline">\(p\)</span> using our understanding of basic geometry. Looking at the figure above, it is intuitively obvious that the shortest path between the tip of <span class="math inline">\(b\)</span> and the projection <span class="math inline">\(p\)</span> onto <span class="math inline">\(a\)</span> is that which is perpendicular to the line <span class="math inline">\(a\)</span>. The path between <span class="math inline">\(b\)</span> and <span class="math inline">\(p\)</span> is simply <span class="math inline">\(b - p\)</span>. In linear algebra terms, we thus want that path to be orthogonal to the line <span class="math inline">\(a\)</span>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Hence, we want:</p>
<p><span class="math display">\[
\begin{aligned}
a'(b - p) &amp;= 0 \\
a'(b - xa) &amp;= 0 \\
a'b - xa'a &amp;= 0 \\
xa'a &amp;= a'b \\
x &amp;= (a'a)^{-1}a'b
\end{aligned}
\]</span></p>
<p>So that, again, we have:<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p><span class="math display">\[
p = ax = \underbrace{a(a'a)^{-1}a'}_\text{$P_a$}b.
\]</span></p>
<p>This also makes clear why this type of projection is called “orthogonal projection”: we want to project a vector onto a subspace in such a way that the distance between the original vector and the subspace is minimal. The resulting projection will be a point on the suspace such that a vector from that point to the original vector is orthogonal to the subspace. Intuitively, this is the case because the shortest path between the vector and the subspace will be that which is perpendicular to the subspace, and orthogonality is the generalisation of the notion of perpendicularity.</p>
</section>
<section id="why-project" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="why-project"><span class="header-section-number">2.2</span> Why project?</h2>
<p>Projection is useful because it allows us to approximately solve systems of linear equations that have no exact solution. Imagine we have the following system of equations:</p>
<p><span class="math display">\[
\begin{align*}
a_{11}x_1 + a_{12}x_2 + \cdots + a_{1k}x_k &amp;= b_1 \\
a_{21}x_1 + a_{22}x_2 + \cdots + a_{2k}x_k &amp;= b_2 \\
\vdots \\
a_{n1}x_1 + a_{n2}x_2 + \cdots + a_{nk}x_k &amp;= b_n
\end{align*}
\]</span></p>
<p>which we can write more compactly in matrix form as:</p>
<p><span class="math display">\[
Ax = b.
\]</span></p>
<p>If <span class="math inline">\(n &gt; k\)</span>, the system is overdetermined – it has more constarints (equations) than degrees of freedom (variables) – and might not have a solution. In this case, it can be useful to solve</p>
<p><span class="math display">\[
Ax = \hat{b},
\]</span></p>
<p>where <span class="math inline">\(\hat{b}\)</span> is the orthogonal projection of <span class="math inline">\(b\)</span> onto the vector space spanned by <span class="math inline">\(A\)</span>, called the span or column space of <span class="math inline">\(A\)</span>. Using orthogonal projection in this case achieves two things: it guarantees a solution because <span class="math inline">\(\hat{b}\)</span> lies on the same space as <span class="math inline">\(Ax\)</span> – they both lie on the subspace spanned by the columns of <span class="math inline">\(A\)</span> – and is makes <span class="math inline">\(\hat{p}\)</span> the best approximation to <span class="math inline">\(b\)</span> in that it is closest to it in terms of the Euclidean distance.</p>
</section>
<section id="projection-from-3-d-onto-2-d-and-projecting-onto-n-d" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="projection-from-3-d-onto-2-d-and-projecting-onto-n-d"><span class="header-section-number">2.3</span> Projection from 3-D onto 2-D and projecting onto N-D</h2>
<p>Our starting point is similar to the 2-D onto 1-D example above, but our vector <span class="math inline">\(b\)</span> is now 3-dimensional and the subspace we project it onto is now not a 1-dimensional line but a 2-dimensional plane. Hence, <span class="math inline">\(p\)</span> is now a point in the 3-dimensional space that lies on the 2-dimensional subspace. Above, we defined <span class="math inline">\(p\)</span> as <span class="math inline">\(p = ax\)</span>, where <span class="math inline">\(a\)</span> was the scalar that characterised the line and <span class="math inline">\(x\)</span> the scalar that helped us move along that line. Similarly, we now have <span class="math inline">\(p = Ax\)</span>, where <span class="math inline">\(A\)</span> is a 2 x 2 matrix, the two columns of which are the base vectors of the 2-dimensional subspace.</p>
<p>We can still go about finding <span class="math inline">\(p\)</span> in the same way as above:</p>
<p><span class="math display">\[
\begin{aligned}
argmin_{x} (b - Ax)'(b - Ax) \\
\frac{d}{dx} (b - Ax)'(b - Ax) &amp;= -2A'(b - Ax) = 0
\end{aligned}
\]</span></p>
<p>Solving for <span class="math inline">\(x\)</span> we get: <span class="math display">\[
\begin{aligned}
-2A'(b - Ax) &amp;= 0 \\
-A'b + A'Ax &amp;= 0 \\
A'Ax &amp;= A'b \\
x &amp;= (A'A)^{-1}A'b
\end{aligned}
\]</span></p>
<p>The last step above works only if <span class="math inline">\(A'A\)</span> is actually invertible, which is the case if <span class="math inline">\(A\)</span> has full rank, which is the case if none of its columns can be constructed from a linear combination of any other columns. (A visual way to think about this is the following: the columns of a matrix are the basis vectors of its column space. The rank is the number of dimensions of that column space. Full rank means that the column space has as many dimensions as there are columns.)</p>
<p>The math above generalises directly to projections onto N-dimensional space. All that changes is that <span class="math inline">\(b\)</span>, <span class="math inline">\(A\)</span>, <span class="math inline">\(x\)</span>, and <span class="math inline">\(p\)</span> are higher-dimensional objects, and that visualising what’s happening becomes rather mind-bending.</p>
</section>
<section id="useful-references" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="useful-references"><span class="header-section-number">2.4</span> Useful references</h2>
<ul>
<li><p><a href="https://ocw.mit.edu/courses/18-06-linear-algebra-spring-2010/video_galleries/video-lectures/">Gilbert Strang’s linear algebra lectures at MIT</a></p></li>
<li><p><a href="https://bookdown.org/ts_robinson1994/10EconometricTheorems/linear_projection.html#linear_projection">10 Fundamental Theorems for Econometrics</a></p></li>
</ul>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>A subspace is a subset of a vector space that is itself a vector space in which any possible linear combination of two vectors in the space is also in the space. For instance, a 2-dimensional plane is a subspace of <span class="math inline">\(\mathbb{R}^3\)</span> if it contains all possible linear combinations of any 2-dimensional vectors. For this to be the case, the plane has to go through the origin – the point (0, 0, 0) – to contain linear combinations with the zero scalar. Similarly, a line that goes through the origin is also a valid subspace, since any linear combination of two vectors that lie on the line will also lie on the line.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The Euclidean distance between two points <span class="math inline">\(x\)</span> and <span class="math inline">\(\bar{x}\)</span> in <span class="math inline">\(\mathbb{R}^N\)</span> is defined as <span class="math inline">\(\sqrt{\sum_{i=1}^N{(\bar{x_i} - x_i})^2}\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>A line through the origin is a subspace of a two-dimensional vector because it is 1-dimensional (and thus a subset of the 2-dimensional vector) and because all possible linear combinations of vectors on the line will also lie on the line (the line needs to pass through the origin for this latter statement to be true, see the footnote on subspaces).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>TODO explain concept of orthogonality and why it is equivalent to the dot-product being zero.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>TODO show what happens if we define <span class="math inline">\(p = xa\)</span> instead of <span class="math inline">\(p = ax\)</span><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/regression.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>